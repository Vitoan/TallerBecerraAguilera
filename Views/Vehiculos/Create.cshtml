@model TallerBecerraAguilera.Models.Vehiculos

@{
    ViewData["Title"] = "Nuevo Vehículo";
}

<div class="max-w-4xl mx-auto">
    
    <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Registrar Vehículo</h2>
        <p class="text-sm text-gray-500">Agregue una nueva unidad al sistema y asígnela a un cliente.</p>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 md:p-8">
        <form asp-action="Create" class="space-y-8">
            <div asp-validation-summary="ModelOnly" class="bg-red-50 text-red-600 p-4 rounded-lg text-sm border border-red-100"></div>

            <div>
                <h3 class="text-xs font-bold text-primary uppercase tracking-wider mb-4 border-b border-gray-100 pb-2 flex items-center gap-2">
                    <i class="bi bi-car-front-fill"></i> Información de la Unidad
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label asp-for="patente" class="block text-sm font-medium text-gray-700 mb-1">Patente / Dominio</label>
                        <div class="relative">
                            <input asp-for="patente" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-colors text-gray-800 font-bold uppercase placeholder-gray-400" placeholder="AA 123 BB" />
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                <i class="bi bi-postcard text-gray-400"></i>
                            </div>
                        </div>
                        <span asp-validation-for="patente" class="text-xs text-red-500 mt-1 block"></span>
                    </div>

                    <div>
                        <label asp-for="tipo" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Vehículo</label>
                        <select asp-for="tipo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-colors bg-white text-gray-700" 
                                asp-items="Html.GetEnumSelectList<TallerBecerraAguilera.Models.TipoVehiculo>()"></select>
                        <span asp-validation-for="tipo" class="text-xs text-red-500 mt-1 block"></span>
                    </div>

                    <div>
                        <label asp-for="anio" class="block text-sm font-medium text-gray-700 mb-1">Año</label>
                        <input asp-for="anio" type="number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-colors text-gray-700" placeholder="2024" />
                        <span asp-validation-for="anio" class="text-xs text-red-500 mt-1 block"></span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label asp-for="marca" class="block text-sm font-medium text-gray-700 mb-1">Marca</label>
                        <input asp-for="marca" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-colors text-gray-700" placeholder="Ej: Toyota, Ford..." />
                        <span asp-validation-for="marca" class="text-xs text-red-500 mt-1 block"></span>
                    </div>

                    <div>
                        <label asp-for="modelo" class="block text-sm font-medium text-gray-700 mb-1">Modelo</label>
                        <input asp-for="modelo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-colors text-gray-700" placeholder="Ej: Hilux, Focus..." />
                        <span asp-validation-for="modelo" class="text-xs text-red-500 mt-1 block"></span>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xs font-bold text-primary uppercase tracking-wider mb-4 border-b border-gray-100 pb-2 flex items-center gap-2 mt-4">
                    <i class="bi bi-person-badge-fill"></i> Propietario
                </h3>
                
                <div class="grid grid-cols-1 gap-6">
                    <div>
                        <label asp-for="clienteId" class="block text-sm font-medium text-gray-700 mb-1">Cliente Asignado</label>
                        <select asp-for="clienteId" class="w-full" id="buscadorClientes">
                            <option value="">Buscar por nombre o DNI...</option>
                        </select>
                        <span asp-validation-for="clienteId" class="text-xs text-red-500 mt-1 block"></span>
                        <p class="text-xs text-gray-400 mt-1">
                            <i class="bi bi-info-circle"></i> Si el cliente no existe, debe registrarlo primero en la sección Clientes.
                        </p>
                    </div>
                </div>
            </div>

            <div>
                <label asp-for="observaciones" class="block text-sm font-medium text-gray-700 mb-1">Observaciones / Detalles</label>
                <textarea asp-for="observaciones" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-colors text-gray-700" placeholder="Color, detalles estéticos, nro de chasis..."></textarea>
            </div>

            <div class="flex items-center gap-4 pt-4 border-t border-gray-100">
                <button type="submit" class="bg-primary hover:bg-primaryDark text-white px-6 py-2.5 rounded-xl shadow-sm font-medium transition flex items-center gap-2">
                    <i class="bi bi-save"></i> Guardar Vehículo
                </button>
                <a asp-action="Index" class="text-gray-500 hover:text-gray-700 font-medium px-4 py-2 rounded-xl hover:bg-gray-100 transition">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <style>
        /* === TUNEADO DE SELECT2 PARA QUE SE PAREZCA A TAILWIND === */
        .select2-container .select2-selection--single {
            height: 42px !important; 
            border-color: #d1d5db !important; /* gray-300 */
            border-radius: 0.5rem !important; /* rounded-lg */
            padding-top: 6px;
            padding-left: 6px;
        }
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            top: 8px !important;
            right: 8px !important;
        }
        .select2-container--default .select2-selection--single:focus {
            border-color: #6C63FF !important; /* primary color */
            outline: none;
        }
    </style>
    
    <script>
        $(document).ready(function() {
            $('#buscadorClientes').select2({
                placeholder: 'Seleccione un cliente',
                allowClear: true,
                width: '100%',
                minimumInputLength: 1,
                language: {
                    noResults: function() { return "No se encontraron clientes"; },
                    searching: function() { return "Buscando..."; }
                },
                ajax: {
                    url: '@Url.Action("BuscarClientes", "Clientes")',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return { term: params.term };
                    },
                    processResults: function (data) {
                        return { results: data.results };
                    },
                    cache: true
                }
            });
        });
    </script>
}