@using TallerBecerraAguilera.Helpers;
@model PaginatedList<TallerBecerraAguilera.Models.OrdenesTrabajo>
@using TallerBecerraAguilera.Models
@{
    ViewData["Title"] = "Mis rdenes de Trabajo";
}

<div class="container mt-4">
    <h2 class="fw-bold text-info mb-4"> Mis rdenes de Trabajo</h2>

    @if (!Model.Any())
    {
        <div class="alert alert-warning">
            No ten茅s 贸rdenes asignadas actualmente.
        </div>
    }
    else
    {
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>OT</th>
                    <th>Veh铆culo</th>
                    <th>Descripci贸n</th>
                    <th>Estado</th>
                    <th>Fecha Ingreso</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var ot in Model)
                {
                    <tr>
                        <td>@ot.Id</td>
                        <td>@ot.Vehiculo?.patente</td>
                        <td>@ot.DescripcionFalla</td>
                        <td>
                            <span class="badge @(ot.Estado == EstadoOrden.Pendiente ? "bg-secondary" :
                                                ot.Estado == EstadoOrden.EnReparacion ? "bg-warning text-dark" :
                                                ot.Estado == EstadoOrden.Finalizada ? "bg-success" :
                                                ot.Estado == EstadoOrden.Entregada ? "bg-info" : "bg-light")">
                                @ot.Estado
                            </span>
                        </td>
                        <td>@ot.FechaIngreso.ToShortDateString()</td>
                        <td>
                            <form asp-action="CambiarEstado" method="post" class="d-inline">
                                <input type="hidden" name="id" value="@ot.Id" />
                                <select name="nuevoEstado" class="form-select form-select-sm d-inline w-auto">
                                    @foreach (EstadoOrden estado in Enum.GetValues(typeof(EstadoOrden)))
                                    {
                                        var isSelected = (ot.Estado == estado) ? "selected" : "";
                                        var displayName = estado switch
                                        {
                                            EstadoOrden.Pendiente => "Pendiente (Ingreso)",
                                            EstadoOrden.EnReparacion => "En Reparaci贸n",
                                            EstadoOrden.Finalizada => "Finalizada (Esperando Retiro)",
                                            EstadoOrden.Entregada => "Entregada (Cerrada)",
                                            _ => estado.ToString()
                                        };
                                        @:<option value="@( (int)estado )" @isSelected>@displayName</option>
                                    }
                                </select>
                                <button type="submit" class="btn btn-sm btn-primary ms-1">Actualizar</button>
                                <a asp-action="Details" asp-route-id="@ot.Id" class="btn btn-sm btn-info ms-1">Detalles</a>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Paginaci贸n -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                <li class="page-item @(Model.HasPreviousPage ? "" : "disabled")">
                    <a class="page-link" asp-action="MisOTs" asp-route-pageNumber="@(Model.PageIndex - 1)">Anterior</a>
                </li>
                @for (int i = 1; i <= Model.TotalPages; i++)
                {
                    <li class="page-item @(i == Model.PageIndex ? "active" : "")">
                        <a class="page-link" asp-action="MisOTs" asp-route-pageNumber="@i">@i</a>
                    </li>
                }
                <li class="page-item @(Model.HasNextPage ? "" : "disabled")">
                    <a class="page-link" asp-action="MisOTs" asp-route-pageNumber="@(Model.PageIndex + 1)">Siguiente</a>
                </li>
            </ul>
        </nav>
    }
</div>
