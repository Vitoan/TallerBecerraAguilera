@using TallerBecerraAguilera.Helpers
@using TallerBecerraAguilera.Models
@model PaginatedList<TallerBecerraAguilera.Models.PedidosRepuestos>

@{
    ViewData["Title"] = "Pedidos de Repuestos";
}

<div class="container mx-auto px-4 py-8">

    <!-- HEADER -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
        <div>
            <h1 class="text-3xl font-bold text-indigo-800">@ViewData["Title"]</h1>
            <p class="text-gray-500 mt-1">Historial de compras y órdenes a proveedores.</p>
        </div>

        <a asp-action="Create"
           class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                      d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                      clip-rule="evenodd" />
            </svg>
            Nuevo Pedido
        </a>
    </div>

    <!-- FILTROS -->
    <form method="get" class="bg-white p-4 rounded-xl shadow border border-gray-200 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

            <div>
                <label class="text-xs font-bold text-gray-600">Desde</label>
                <input type="date" name="fechaDesde"
                       value="@(ViewBag.FechaDesde?.ToString("yyyy-MM-dd"))"
                       class="w-full border rounded px-2 py-1 text-sm" />
            </div>

            <div>
                <label class="text-xs font-bold text-gray-600">Hasta</label>
                <input type="date" name="fechaHasta"
                       value="@(ViewBag.FechaHasta?.ToString("yyyy-MM-dd"))"
                       class="w-full border rounded px-2 py-1 text-sm" />
            </div>

            <div>
                <label class="text-xs font-bold text-gray-600">Proveedor</label>
                <select name="proveedorId" class="w-full border rounded px-2 py-1 text-sm">
                    <option value="">Todos</option>
                    @foreach (var p in ViewBag.Proveedores)
                    {
                        <option value="@p.Id" selected="@(ViewBag.ProveedorId == p.Id)">
                            @p.Nombre
                        </option>
                    }
                </select>
            </div>

            <div>
                <label class="text-xs font-bold text-gray-600">Estado</label>
                <select name="estado" class="w-full border rounded px-2 py-1 text-sm">
                    <option value="">Todos</option>
                    <option value="Pendiente" selected="@(ViewBag.Estado == EstadoPedido.Pendiente)">Pendiente</option>
                    <option value="Recibido" selected="@(ViewBag.Estado == EstadoPedido.Recibido)">Recibido</option>
                    <option value="Cancelado" selected="@(ViewBag.Estado == EstadoPedido.Cancelado)">Cancelado</option>
                </select>
            </div>
        </div>

        <div class="flex justify-end gap-2 mt-4">
            <button type="submit"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded text-sm font-bold">
                Filtrar
            </button>

            <a asp-action="Index"
               class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded text-sm font-bold">
                Limpiar
            </a>
        </div>
    </form>

    <!-- SIN DATOS -->
    @if (!Model.Any())
    {
        <div class="bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-12 text-center">
            <h3 class="text-lg font-bold text-gray-700">No hay pedidos registrados</h3>
            <p class="text-gray-500 mt-1">Probá cambiando los filtros.</p>
        </div>
    }
    else
    {
        <!-- TABLA -->
        <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="bg-indigo-50 border-b">
                        <tr>
                            <th class="px-5 py-3 text-xs font-bold text-indigo-600">ID</th>
                            <th class="px-5 py-3 text-xs font-bold text-indigo-600">Proveedor</th>
                            <th class="px-5 py-3 text-xs font-bold text-indigo-600">Solicitado por</th>
                            <th class="px-5 py-3 text-xs font-bold text-indigo-600">Fecha</th>
                            <th class="px-5 py-3 text-xs font-bold text-indigo-600 text-center">Estado</th>
                            <th class="px-5 py-3 text-xs font-bold text-indigo-600 text-right">Acciones</th>
                        </tr>
                    </thead>

                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr class="border-b hover:bg-gray-50">

                                <td class="px-5 py-4 font-mono text-indigo-600 font-bold">#@item.Id</td>

                                <td class="px-5 py-4">@item.Proveedor?.Nombre</td>

                                <td class="px-5 py-4">@item.Empleado?.NombreCompleto</td>

                                <td class="px-5 py-4">@item.Fecha.ToString("dd/MM/yyyy")</td>

                                <td class="px-5 py-4 text-center">
                                    @{
                                        var badge = item.Estado switch
                                        {
                                            EstadoPedido.Pendiente => "bg-yellow-100 text-yellow-800",
                                            EstadoPedido.Recibido => "bg-green-100 text-green-800",
                                            EstadoPedido.Cancelado => "bg-red-100 text-red-800",
                                            _ => "bg-gray-100 text-gray-800"
                                        };
                                    }
                                    <span class="px-2 py-1 rounded-full text-xs font-bold @badge">
                                        @item.Estado
                                    </span>
                                </td>

                                <td class="px-5 py-4 text-right">
                                    <a asp-action="Details" asp-route-id="@item.Id"
                                       class="text-blue-600 hover:underline">
                                        Ver
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- PAGINACIÓN -->
            <div class="bg-gray-50 px-5 py-3 flex justify-between items-center">
                <span class="text-sm">
                    Página <b>@Model.PageIndex</b> de <b>@Model.TotalPages</b>
                </span>

                <div class="flex gap-2">
                    <a asp-action="Index"
                       asp-route-pageNumber="@(Model.PageIndex - 1)"
                       asp-route-fechaDesde="@ViewBag.FechaDesde"
                       asp-route-fechaHasta="@ViewBag.FechaHasta"
                       asp-route-proveedorId="@ViewBag.ProveedorId"
                       asp-route-estado="@ViewBag.Estado"
                       class="px-3 py-1 border rounded @(!Model.HasPreviousPage ? "opacity-50 pointer-events-none" : "")">
                        Anterior
                    </a>

                    <a asp-action="Index"
                       asp-route-pageNumber="@(Model.PageIndex + 1)"
                       asp-route-fechaDesde="@ViewBag.FechaDesde"
                       asp-route-fechaHasta="@ViewBag.FechaHasta"
                       asp-route-proveedorId="@ViewBag.ProveedorId"
                       asp-route-estado="@ViewBag.Estado"
                       class="px-3 py-1 border rounded @(!Model.HasNextPage ? "opacity-50 pointer-events-none" : "")">
                        Siguiente
                    </a>
                </div>
            </div>
        </div>
    }
</div>
